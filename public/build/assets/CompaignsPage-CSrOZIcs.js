import{r as n,j as e,a as k,b as W}from"./app-rXjYUJAF.js";import{ae as l,af as E,a5 as j,an as w,Q as p,ab as B,ad as I,ao as P,a6 as T,P as D,ag as R,ah as A,ai as H,aj as y,ak as b,al as G,am as U}from"./GuestLayout-BAdTHTcx.js";import{T as z}from"./TablePagination-D2iMuyxA.js";const L=({title:s})=>{const t={wika:!1,swagelo:!1,hylok:!1,hy_lok:!1},[a,i]=n.useState(t);return n.useEffect(()=>{switch(s){case"wika":i({...a,wika:!0});break;case"swagelo":i({...a,swagelo:!0});break;case"hylok":i({...a,hylok:!0});break;case"hy-lok":i({...a,hy_lok:!0});break}},[s]),e.jsx(l,{container:!0,sx:{padding:"10px"},children:e.jsx(l,{item:!0,xs:12,children:e.jsxs(E,{color:"info",variant:"contained",size:"large","aria-label":"Large button group",children:[e.jsx(k,{href:route("compaigns.wika"),children:e.jsx(j,{disabled:a.wika,children:"Wika"})}),e.jsx(k,{href:route("compaigns.swagelo"),children:e.jsx(j,{disabled:a.swagelo,children:"Swagelo"})}),e.jsx(k,{href:route("compaigns.hylok"),children:e.jsx(j,{disabled:a.hylok,children:"Hylok"})}),e.jsx(k,{href:route("compaigns.hy-lok"),children:e.jsx(j,{disabled:a.hy_lok,children:"Hy-lok"})})]})})})};function M({open:s,handleClose:t,skeleton:a,dataForModal:i}){console.log(i);const m=n.useCallback(c=>{const h=[],u=[];for(let r in c.groups)h.push(e.jsxs(w,{className:"compaigns_card",sx:{maxWidth:"360px",borderRight:"solid 1px"},children:[e.jsxs(p,{display:"flex",justifyContent:"space-between",className:"card_text compaigns_text_card",variant:"p",children:[e.jsx("span",{display:"flex",justifyContent:"space-between",className:"titile_header",children:"Название: "}),e.jsx("span",{children:c.groups[r].adGroupName})]}),e.jsxs(p,{display:"flex",justifyContent:"space-between",className:"card_text compaigns_text_card",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Количество кликов: "}),e.jsx("span",{children:c.groups[r].clicks})]}),e.jsxs(p,{display:"flex",justifyContent:"space-between",className:"card_text compaigns_text_card",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Cумма затрат: "}),e.jsx("span",{children:c.groups[r].cost.toFixed(2)})]})]}));console.log(c.clients);for(let r in c.clients)c.clients[r].forEach(o=>{o.forEach(d=>{u.push(e.jsxs(w,{className:"compaigns_card",sx:{maxWidth:"860px"},children:[e.jsxs(p,{display:"flex",justifyContent:"space-between",className:"card_text",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Email клиента: "}),e.jsx("span",{children:d.client_mail})]}),e.jsxs(p,{display:"flex",justifyContent:"space-between",className:"card_text",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Сумма покупок: "}),e.jsx("span",{children:d.invoice_price})]}),e.jsxs(p,{display:"flex",justifyContent:"space-between",className:"card_text",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Дата покупки: "}),e.jsx("span",{children:d.invoice_date})]})]}))})});return e.jsxs(e.Fragment,{children:[e.jsx(l,{item:!0,sx:{maxWidth:"500px",width:"100%"},xs:4,children:h.map(r=>r)}),e.jsx(l,{sx:{maxWidth:"360px",width:"100%"},item:!0,xs:6,children:u.map(r=>r)})]})});return e.jsx(n.Fragment,{children:e.jsxs(B,{open:s,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"xl",children:[e.jsx(I,{children:e.jsxs(l,{container:!0,spacing:2,sx:{width:"1200px",height:"760px"},children:[a?"":e.jsxs(e.Fragment,{children:[e.jsx(l,{item:!0,xs:4,children:e.jsx(P,{variant:"rectangular",width:360,height:660})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(P,{variant:"rectangular",width:760,height:660})})]}),i?m(i):""]})}),e.jsx(T,{children:e.jsx(j,{onClick:t,children:"Закрыть"})})]})})}const _=[{id:"title",label:"Название компании",minWidth:170},{id:"clients",label:"количество клиентов по 1С",minWidth:170,align:"center",format:s=>s},{id:"clicks",label:"общее количество кликов",minWidth:170,align:"center",format:s=>s},{id:"cost",label:"сумма затрат на компанию",minWidth:170,align:"center",format:s=>s.toFixed(2)},{id:"profit",label:"прибыль по клиентам из 1С",minWidth:170,align:"center",format:s=>s.toFixed(2)}],O=s=>{let t=0;for(let a in s)t+=s[a].length;return t},V=s=>{let t=0;for(let a in s)s[a].forEach(i=>{i.forEach(m=>{t+=Number(m.invoice_price)})});return t},Q=s=>{let t=[];for(let a in s)t.push({title:"ID: "+a+" | "+s[a].compaignName,clients:O(s[a].clients),clicks:s[a].clicks,cost:s[a].cost.toFixed(2),profit:V(s[a].clients),id:a});return t},q=(s,t)=>{setPage(t)},J=s=>{setRowsPerPage(+s.target.value),setPage(0)};function K({compaignsData:s}){const[t,a]=n.useState(0),[i,m]=n.useState(10),[c,h]=n.useState(!1),[u,f]=n.useState(!1),[r,o]=n.useState([]),[d,v]=n.useState([]),N=x=>{h(!0),v(s[x]),f(!0)},F=()=>{h(!1)};return n.useEffect(()=>{o(Q(s))},[s]),e.jsxs(D,{sx:{width:"100%",margin:"0 auto"},children:[e.jsx(R,{sx:{maxHeight:600},children:e.jsxs(A,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsxs(H,{children:[e.jsx(y,{children:e.jsx(b,{size:"string",align:"left",colSpan:12,children:e.jsx(p,{variant:"h3"})})}),e.jsx(y,{children:_.map(x=>e.jsx(b,{align:x.align,style:{minWidth:x.minWidth},children:x.label},x.id))})]}),e.jsx(G,{children:r.slice(t*i,t*i+i).map((x,S)=>e.jsx(y,{hover:!0,role:"checkbox",tabIndex:-1,sx:{cursor:"pointer"},onClick:()=>N(x.id),children:_.map(g=>{const C=x[g.id];return e.jsx(b,{align:g.align,children:g.format&&typeof C=="number"?g.format(C):C},g.id)})},S))})]})}),e.jsx(z,{rowsPerPageOptions:[10,25,100],component:"div",count:r.length,rowsPerPage:i,page:t,onPageChange:q,onRowsPerPageChange:J,labelRowsPerPage:"Выводить по :"}),e.jsx(M,{handleClose:F,open:c,skeleton:u,dataForModal:d})]})}const X=s=>{let t=0;return s.lenght&&s.forEach(a=>{t+=Number(a.invoice_price)}),t},Y=s=>{let t={clientsIn1C:0,sumClicks:0,sumPriceForCompaign:0,profitBy1C:0};if(s){for(let a in s)t.clientsIn1C+=s[a].clients.length,t.sumClicks+=s[a].clicks,t.sumPriceForCompaign+=s[a].cost,t.profitBy1C=X(s[a].clients);return t={...t,clientsIn1C:t.clientsIn1C,sumClicks:t.sumClicks,sumPriceForCompaign:t.sumPriceForCompaign.toFixed(2),profitBy1C:t.profitBy1C.toFixed(2)},t}return t},se=({data:s})=>{const[t,a]=n.useState([]),[i]=n.useState(s.routePath),[m,c]=n.useState(!1),[h,u]=n.useState({clientsIn1C:0,sumClicks:0,sumPriceForCompaign:0,profitBy1C:0}),f=o=>{setDateUpdate(o)},r=()=>{let o="compaigns.wika.invoice";switch(i){case"wika":o="compaigns.wika.invoice";break;case"swagelo":o="compaigns.swagelo.invoice";break;case"hylok":o="compaigns.hylok.invoice";break;case"hy-lok":o="compaigns.hy-lok.invoice";break}W.post(route(o)).then(d=>{console.log(d.data),a(d.data.direct),u(Y(d.data.direct)),c(!0)}).catch(d=>{console.log(d)})};return n.useEffect(()=>{r()},[]),e.jsxs(U,{dateUpdateDirect:s.dateUpdateDirect,updateDirectDate:f,children:[e.jsx(L,{title:s.routePath}),e.jsx("hr",{}),e.jsx("br",{}),e.jsx(l,{container:!0,children:e.jsx(K,{compaignsData:t})}),e.jsxs(l,{container:!0,sx:{padding:"15px",border:"solid black 1px"},children:[e.jsx(l,{item:!0,sx:{textAlign:"center"},xs:4.5,children:"ИТОГО:"}),e.jsx(l,{item:!0,sx:{textAlign:"center"},xs:1.9,children:h.clientsIn1C}),e.jsx(l,{item:!0,sx:{textAlign:"center"},xs:1.9,children:h.sumClicks}),e.jsx(l,{item:!0,sx:{textAlign:"center"},xs:1.9,children:h.sumPriceForCompaign}),e.jsx(l,{item:!0,sx:{textAlign:"center"},xs:1.8,children:h.profitBy1C})]})]})};export{se as default};
