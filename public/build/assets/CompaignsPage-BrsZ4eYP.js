import{r as n,j as e,a as w,b as A}from"./app-BKFpO3iw.js";import{l as G,t as H,ak as U,y as I,A as _,_ as v,al as z,z as L,g as V,i as K,k as O,a9 as d,aa as Z,$ as b,ai as R,I as f,a6 as q,a8 as J,aj as W,a0 as Q,U as X,ab as Y,ac as ee,ad as se,ae as D,af as F,ag as te,ah as re}from"./GuestLayout-Bcyqjrdc.js";import{T as ae}from"./TablePagination-Bu7ZHOZm.js";function ie(s){return G("MuiCircularProgress",s)}H("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const ne=["className","color","disableShrink","size","style","thickness","value","variant"];let S=s=>s,E,$,B,M;const g=44,oe=U(E||(E=S`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`)),le=U($||($=S`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`)),ce=s=>{const{classes:t,variant:r,color:a,disableShrink:u}=s,o={root:["root",r,`color${_(a)}`],svg:["svg"],circle:["circle",`circle${_(r)}`,u&&"circleDisableShrink"]};return O(o,ie,t)},de=I("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.root,t[r.variant],t[`color${_(r.color)}`]]}})(({ownerState:s,theme:t})=>v({display:"inline-block"},s.variant==="determinate"&&{transition:t.transitions.create("transform")},s.color!=="inherit"&&{color:(t.vars||t).palette[s.color].main}),({ownerState:s})=>s.variant==="indeterminate"&&z(B||(B=S`
      animation: ${0} 1.4s linear infinite;
    `),oe)),he=I("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(s,t)=>t.svg})({display:"block"}),xe=I("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.circle,t[`circle${_(r.variant)}`],r.disableShrink&&t.circleDisableShrink]}})(({ownerState:s,theme:t})=>v({stroke:"currentColor"},s.variant==="determinate"&&{transition:t.transitions.create("stroke-dashoffset")},s.variant==="indeterminate"&&{strokeDasharray:"80px, 200px",strokeDashoffset:0}),({ownerState:s})=>s.variant==="indeterminate"&&!s.disableShrink&&z(M||(M=S`
      animation: ${0} 1.4s ease-in-out infinite;
    `),le)),ue=n.forwardRef(function(t,r){const a=L({props:t,name:"MuiCircularProgress"}),{className:u,color:o="primary",disableShrink:x=!1,size:p=40,style:k,thickness:i=3.6,value:l=0,variant:c="indeterminate"}=a,N=V(a,ne),j=v({},a,{color:o,disableShrink:x,size:p,thickness:i,value:l,variant:c}),C=ce(j),h={},P={},m={};if(c==="determinate"){const y=2*Math.PI*((g-i)/2);h.strokeDasharray=y.toFixed(3),m["aria-valuenow"]=Math.round(l),h.strokeDashoffset=`${((100-l)/100*y).toFixed(3)}px`,P.transform="rotate(-90deg)"}return e.jsx(de,v({className:K(C.root,u),style:v({width:p,height:p},P,k),ownerState:j,ref:r,role:"progressbar"},m,N,{children:e.jsx(he,{className:C.svg,ownerState:j,viewBox:`${g/2} ${g/2} ${g} ${g}`,children:e.jsx(xe,{className:C.circle,style:h,ownerState:j,cx:g,cy:g,r:(g-i)/2,fill:"none",strokeWidth:i})})}))}),pe=({title:s})=>{const t={wika:!1,swagelo:!1,hylok:!1,hy_lok:!1},[r,a]=n.useState(t);return n.useEffect(()=>{switch(s){case"wika":a({...r,wika:!0});break;case"swagelo":a({...r,swagelo:!0});break;case"hylok":a({...r,hylok:!0});break;case"hy-lok":a({...r,hy_lok:!0});break}},[s]),e.jsx(d,{container:!0,sx:{padding:"10px"},children:e.jsx(d,{item:!0,xs:12,children:e.jsxs(Z,{color:"info",variant:"contained",size:"large","aria-label":"Large button group",children:[e.jsx(w,{href:route("compaigns.wika"),children:e.jsx(b,{disabled:r.wika,children:"Wika"})}),e.jsx(w,{href:route("compaigns.swagelo"),children:e.jsx(b,{disabled:r.swagelo,children:"Swagelo"})}),e.jsx(w,{href:route("compaigns.hylok"),children:e.jsx(b,{disabled:r.hylok,children:"Hylok"})}),e.jsx(w,{href:route("compaigns.hy-lok"),children:e.jsx(b,{disabled:r.hy_lok,children:"Hy-lok"})})]})})})};function me({open:s,handleClose:t,skeleton:r,dataForModal:a}){console.log(a);const u=n.useCallback(o=>{const x=[],p=[];for(let i in o.groups)x.push(e.jsxs(R,{className:"compaigns_card",sx:{maxWidth:"360px",borderRight:"solid 1px"},children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",className:"card_text compaigns_text_card",variant:"p",children:[e.jsx("span",{display:"flex",justifyContent:"space-between",className:"titile_header",children:"Название: "}),e.jsx("span",{children:o.groups[i].adGroupName})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",className:"card_text compaigns_text_card",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Количество кликов: "}),e.jsx("span",{children:o.groups[i].clicks})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",className:"card_text compaigns_text_card",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Cумма затрат: "}),e.jsx("span",{children:o.groups[i].cost.toFixed(2)})]})]}));console.log(o.clients);for(let i in o.clients)o.clients[i].forEach(l=>{l.forEach(c=>{p.push(e.jsxs(R,{className:"compaigns_card",sx:{maxWidth:"860px"},children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",className:"card_text",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Email клиента: "}),e.jsx("span",{children:c.client_mail})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",className:"card_text",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Сумма покупок: "}),e.jsx("span",{children:c.invoice_price})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",className:"card_text",variant:"p",children:[e.jsx("span",{className:"titile_header",children:"Дата покупки: "}),e.jsx("span",{children:c.invoice_date})]})]}))})});return e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,sx:{maxWidth:"500px",width:"100%"},xs:4,children:x.map(i=>i)}),e.jsx(d,{sx:{maxWidth:"360px",width:"100%"},item:!0,xs:6,children:p.map(i=>i)})]})});return e.jsx(n.Fragment,{children:e.jsxs(q,{open:s,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"xl",children:[e.jsx(J,{children:e.jsxs(d,{container:!0,spacing:2,sx:{width:"1200px",height:"760px"},children:[r?"":e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:4,children:e.jsx(W,{variant:"rectangular",width:360,height:660})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(W,{variant:"rectangular",width:760,height:660})})]}),a?u(a):""]})}),e.jsx(Q,{children:e.jsx(b,{onClick:t,children:"Закрыть"})})]})})}const T=[{id:"title",label:"Название компании",minWidth:170},{id:"clients",label:"количество клиентов по 1С",minWidth:170,align:"center",format:s=>s},{id:"clicks",label:"общее количество кликов",minWidth:170,align:"center",format:s=>s},{id:"cost",label:"сумма затрат на компанию",minWidth:170,align:"center",format:s=>s.toFixed(2)},{id:"profit",label:"прибыль по клиентам из 1С",minWidth:170,align:"center",format:s=>s.toFixed(2)}],ge=s=>{let t=0;for(let r in s)t+=s[r].length;return t},fe=s=>{let t=0;for(let r in s)s[r].forEach(a=>{a.forEach(u=>{t+=Number(u.invoice_price)})});return t},ke=s=>{let t=[];for(let r in s)t.push({title:"ID: "+r+" | "+s[r].compaignName,clients:ge(s[r].clients),clicks:s[r].clicks,cost:s[r].cost.toFixed(2),profit:fe(s[r].clients),id:r});return t},je=(s,t)=>{setPage(t)},ye=s=>{setRowsPerPage(+s.target.value),setPage(0)};function Ce({compaignsData:s}){const[t,r]=n.useState(0),[a,u]=n.useState(10),[o,x]=n.useState(!1),[p,k]=n.useState(!1),[i,l]=n.useState([]),[c,N]=n.useState([]),j=h=>{x(!0),N(s[h]),k(!0)},C=()=>{x(!1)};return n.useEffect(()=>{l(ke(s))},[s]),e.jsxs(X,{sx:{width:"100%",margin:"0 auto"},children:[e.jsx(Y,{sx:{maxHeight:600},children:e.jsxs(ee,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsxs(se,{children:[e.jsx(D,{children:e.jsx(F,{size:"string",align:"left",colSpan:12,children:e.jsx(f,{variant:"h3"})})}),e.jsx(D,{children:T.map(h=>e.jsx(F,{align:h.align,style:{minWidth:h.minWidth},children:h.label},h.id))})]}),e.jsx(te,{children:i.slice(t*a,t*a+a).map((h,P)=>e.jsx(D,{hover:!0,role:"checkbox",tabIndex:-1,sx:{cursor:"pointer"},onClick:()=>j(h.id),children:T.map(m=>{const y=h[m.id];return e.jsx(F,{align:m.align,children:m.format&&typeof y=="number"?m.format(y):y},m.id)})},P))})]})}),e.jsx(ae,{rowsPerPageOptions:[10,25,100],component:"div",count:i.length,rowsPerPage:a,page:t,onPageChange:je,onRowsPerPageChange:ye,labelRowsPerPage:"Выводить по :"}),e.jsx(me,{handleClose:C,open:o,skeleton:p,dataForModal:c})]})}const be=s=>{let t=0;return s.lenght&&s.forEach(r=>{t+=Number(r.invoice_price)}),t},ve=s=>{let t={clientsIn1C:0,sumClicks:0,sumPriceForCompaign:0,profitBy1C:0};if(s){for(let r in s)t.clientsIn1C+=s[r].clients.length,t.sumClicks+=s[r].clicks,t.sumPriceForCompaign+=s[r].cost,t.profitBy1C=be(s[r].clients);return t={...t,clientsIn1C:t.clientsIn1C,sumClicks:t.sumClicks,sumPriceForCompaign:t.sumPriceForCompaign.toFixed(2),profitBy1C:t.profitBy1C.toFixed(2)},t}return t},Se=({data:s})=>{const[t,r]=n.useState([]),[a]=n.useState(s.routePath),[u,o]=n.useState(!1),[x,p]=n.useState({clientsIn1C:0,sumClicks:0,sumPriceForCompaign:0,profitBy1C:0}),k=l=>{setDateUpdate(l)},i=()=>{o(!1);let l="compaigns.wika.invoice";switch(a){case"wika":l="compaigns.wika.invoice";break;case"swagelo":l="compaigns.swagelo.invoice";break;case"hylok":l="compaigns.hylok.invoice";break;case"hy-lok":l="compaigns.hy-lok.invoice";break}A.post(route(l)).then(c=>{console.log(c.data),r(c.data.direct),p(ve(c.data.direct)),o(!0)}).catch(c=>{console.log(c)})};return n.useEffect(()=>{i()},[]),e.jsxs(re,{dateUpdateDirect:s.dateUpdateDirect,updateDirectDate:k,children:[e.jsx(pe,{title:s.routePath}),e.jsx("hr",{}),e.jsx("br",{}),u?e.jsxs(e.Fragment,{children:[e.jsx(d,{container:!0,children:e.jsx(Ce,{compaignsData:t})}),e.jsxs(d,{container:!0,sx:{padding:"15px",border:"solid black 1px"},children:[e.jsx(d,{item:!0,sx:{textAlign:"center"},xs:4.5,children:"ИТОГО:"}),e.jsx(d,{item:!0,sx:{textAlign:"center"},xs:1.9,children:x.clientsIn1C}),e.jsx(d,{item:!0,sx:{textAlign:"center"},xs:1.9,children:x.sumClicks}),e.jsx(d,{item:!0,sx:{textAlign:"center"},xs:1.9,children:x.sumPriceForCompaign}),e.jsx(d,{item:!0,sx:{textAlign:"center"},xs:1.8,children:x.profitBy1C})]})]}):e.jsx(R,{sx:{display:"dlex",justifyContent:"center",alignItems:"start"},children:e.jsx(ue,{size:150,sx:{margin:"20px 0"}})})]})};export{Se as default};
